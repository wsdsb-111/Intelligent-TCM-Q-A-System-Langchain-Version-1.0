# 向知识图谱添加中药信息指南

## 📋 问题描述

知识图谱中缺少"姜"的信息，需要添加以下内容：
- 增强血液循环
- 刺激胃液分泌
- 兴奋肠管
- 促进消化
- 健胃增进食欲

## 🚀 快速使用

### 方法1：运行预定义脚本（推荐）

```bash
cd 测试与质量保障层/rag评估系统/newragas
python add_herb_to_kg.py
```

**然后选择选项1：** 添加'姜'到知识图谱（预定义数据）

### 方法2：交互式添加

运行脚本后选择选项2，按提示输入信息：
```
请输入中药名称: 姜
性味: 辛，温
归经: 脾经,胃经,肺经
功效: 增强血液循环,刺激胃液分泌,兴奋肠管,促进消化,健胃增进食欲
主治: 风寒感冒,胃寒呕吐
用法用量: 煎服，3-10g
```

## 📊 添加的数据结构

### 节点类型
```cypher
(:中药 {name: "姜"})
(:功效 {name: "增强血液循环"})
(:功效 {name: "刺激胃液分泌"})
(:功效 {name: "兴奋肠管"})
(:功效 {name: "促进消化"})
(:功效 {name: "健胃增进食欲"})
(:经络 {name: "脾经"})
(:经络 {name: "胃经"})
(:经络 {name: "肺经"})
(:疾病 {name: "风寒感冒"})
(:疾病 {name: "胃寒呕吐"})
```

### 关系类型
```cypher
(姜)-[:具有功效]->(增强血液循环)
(姜)-[:具有功效]->(刺激胃液分泌)
(姜)-[:具有功效]->(兴奋肠管)
(姜)-[:具有功效]->(促进消化)
(姜)-[:具有功效]->(健胃增进食欲)
(姜)-[:归经]->(脾经)
(姜)-[:归经]->(胃经)
(姜)-[:归经]->(肺经)
(姜)-[:主治]->(风寒感冒)
(姜)-[:主治]->(胃寒呕吐)
```

### 节点属性
```python
{
  "name": "姜",
  "性味": "辛，温",
  "用法用量": "煎服，3-10g；或捣汁服",
  "备注": "生姜用于解表散寒、温中止呕；干姜温中散寒力强",
  "类别": "中药",
  "更新时间": "2025-10-25T..."
}
```

## 🔧 脚本功能说明

### 1. 添加中药及功效
```python
manager.add_herb_with_effects("姜", {
    "性味": "辛，温",
    "归经": ["脾经", "胃经", "肺经"],
    "功效": ["增强血液循环", "刺激胃液分泌", ...],
    "主治": ["风寒感冒", "胃寒呕吐"],
    "用法": "煎服，3-10g"
})
```

### 2. 查询验证
```python
manager.query_herb("姜")
```

**输出示例：**
```
📋 知识图谱中 '姜' 的信息:
============================================================

🌿 中药: 姜
  性味: 辛，温
  用法用量: 煎服，3-10g；或捣汁服
  类别: 中药

🔗 关系:
  具有功效 -> 增强血液循环
  具有功效 -> 刺激胃液分泌
  具有功效 -> 兴奋肠管
  具有功效 -> 促进消化
  具有功效 -> 健胃增进食欲
  归经 -> 脾经
  归经 -> 胃经
  归经 -> 肺经
  主治 -> 风寒感冒
  主治 -> 胃寒呕吐
============================================================
```

## 📝 添加后的效果

### 知识图谱检索测试

运行知识图谱RAG测试：
```bash
cd 测试与质量保障层/rag评估系统/newragas
python test_kg_rag_flow.py
```

**测试问题：** "姜的功效有哪些？"

**预期输出：**
```
步骤1: 关键词系统提取实体
  提取到实体: ['姜']

步骤2: 在知识图谱中检索实体信息
  ✅ 检索到 5 个上下文
  
  上下文 1: 实体: 姜 | 具有功效: 增强血液循环
  上下文 2: 实体: 姜 | 具有功效: 刺激胃液分泌
  上下文 3: 实体: 姜 | 具有功效: 兴奋肠管
  上下文 4: 实体: 姜 | 具有功效: 促进消化
  上下文 5: 实体: 姜 | 具有功效: 健胃增进食欲

步骤3: 基于检索结果生成答案
  ✅ 答案生成完成
  
  生成的答案:
  姜具有以下功效：1. 增强血液循环 2. 刺激胃液分泌 
  3. 兴奋肠管 4. 促进消化 5. 健胃增进食欲...
```

## 🎯 批量添加中药

如果需要添加多个中药，可以编辑脚本：

```python
# 在 add_herb_to_kg.py 底部添加

def batch_add_herbs():
    """批量添加中药"""
    herbs_data = [
        {
            "name": "姜",
            "info": {
                "性味": "辛，温",
                "功效": ["增强血液循环", "刺激胃液分泌", ...],
                # ... 更多信息
            }
        },
        {
            "name": "枣",
            "info": {
                "性味": "甘，温",
                "功效": ["补中益气", "养血安神"],
                # ... 更多信息
            }
        },
        # 添加更多中药...
    ]
    
    manager = HerbKnowledgeGraphManager(...)
    try:
        for herb_data in herbs_data:
            manager.add_herb_with_effects(
                herb_data["name"], 
                herb_data["info"]
            )
    finally:
        manager.close()
```

## ⚠️ 注意事项

### 1. 数据去重
脚本使用 `MERGE` 操作，自动处理重复数据：
- 如果节点已存在，只更新属性
- 如果关系已存在，不会重复创建

### 2. 数据一致性
确保添加的信息与现有知识图谱的结构一致：
- 节点标签：中药、功效、经络、疾病
- 关系类型：具有功效、归经、主治

### 3. 连接配置
确认Neo4j连接信息正确：
```python
NEO4J_URI = "neo4j://127.0.0.1:7687"
NEO4J_USERNAME = "neo4j"
NEO4J_PASSWORD = "hx1230047"
NEO4J_DATABASE = "neo4j"
```

## 🔍 验证添加结果

### 方法1：使用脚本查询
```bash
python add_herb_to_kg.py
# 选择选项3：查询中药信息
# 输入：姜
```

### 方法2：直接在Neo4j Browser查询
```cypher
MATCH (h:中药 {name: "姜"})-[r]->(target)
RETURN h, r, target
```

### 方法3：运行知识图谱RAG测试
```bash
python test_kg_rag_flow.py
```

## 📚 扩展资源

### Cypher查询示例

**查询所有中药：**
```cypher
MATCH (h:中药) RETURN h.name LIMIT 10
```

**查询中药的功效：**
```cypher
MATCH (h:中药 {name: "姜"})-[:具有功效]->(e:功效)
RETURN e.name
```

**查询具有某功效的所有中药：**
```cypher
MATCH (h:中药)-[:具有功效]->(e:功效 {name: "促进消化"})
RETURN h.name
```

## 🎉 完成

执行脚本后，"姜"及其功效信息将被添加到知识图谱中，知识图谱检索测试将能够成功检索到相关信息！

---

**脚本位置**: `测试与质量保障层/rag评估系统/newragas/add_herb_to_kg.py`  
**文档版本**: v1.0  
**更新时间**: 2025-10-25

