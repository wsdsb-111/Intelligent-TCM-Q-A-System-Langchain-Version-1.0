# 混合问答系统质量测试需求文档

## 项目概述

设计并实现一个测试程序，用于评估混合问答系统的回答质量。该系统集成了BM25、向量检索和知识图谱检索三种检索方式，需要全面评估其性能和质量。

## 功能需求

### 1. 测试数据处理
- 加载test_samples.jsonl测试数据集
- 解析JSONL格式的问答对
- 提取问题、期望答案和系统提示
- 支持批量处理测试样本

### 2. 系统集成
- 初始化混合检索系统
- 配置BM25、向量检索、图检索参数
- 设置RRF融合算法参数
- 处理系统初始化异常

### 3. 质量评估指标

#### 3.1 相关性评分
- 基于检索结果的融合评分
- 评估检索结果与问题的匹配度
- 取最高融合评分作为相关性指标

#### 3.2 覆盖度评分
- 分析问题关键词覆盖情况
- 计算检索结果中包含的关键词比例
- 评估系统对问题要点的理解程度

#### 3.3 准确性评分
- 使用文本相似度算法
- 比较检索结果与期望答案的相似性
- 采用Jaccard相似度计算方法

#### 3.4 融合效果评分
- 评估多检索源的融合质量
- 分析检索源多样性
- 计算评分分布的均匀性

#### 3.5 综合评分
- 加权合并各项评分指标
- 权重分配：相关性30%、覆盖度25%、准确性30%、融合效果15%
- 提供整体质量评估

### 4. 性能监控
- 测量查询响应时间
- 统计成功率和失败率
- 监控系统资源使用情况
- 记录异常和错误信息

### 5. 测试报告生成

#### 5.1 实时进度显示
- 显示测试进度百分比
- 实时输出当前测试状态
- 提供测试过程中的关键信息

#### 5.2 汇总报告
- 生成测试统计信息
- 计算平均性能指标
- 提供质量评估结果
- 输出成功率和响应时间统计

#### 5.3 详细结果
- 展示具体测试样例
- 显示最佳匹配结果
- 提供评分详细信息
- 记录失败测试的错误原因

#### 5.4 报告导出
- 保存JSON格式的详细报告
- 支持后续数据分析
- 便于结果对比和趋势分析

## 技术需求

### 1. 程序架构
- 采用面向对象设计
- 模块化组件结构
- 异步处理支持
- 异常处理机制

### 2. 兼容性要求
- 支持Windows系统
- 兼容Python 3.7+
- 适配现有混合检索系统
- 支持异步事件循环

### 3. 性能要求
- 支持批量测试处理
- 内存使用优化
- 响应时间监控
- 资源清理机制

## 用户体验需求

### 1. 易用性
- 提供简化版和完整版两种模式
- 支持命令行直接运行
- 提供Windows批处理脚本
- 清晰的使用说明文档

### 2. 可视化输出
- 使用表情符号增强可读性
- 彩色进度条和状态显示
- 结构化的报告格式
- 直观的统计图表

### 3. 错误处理
- 友好的错误提示信息
- 自动错误恢复机制
- 详细的调试信息
- 优雅的异常处理

## 质量保证需求

### 1. 测试覆盖
- 支持不同类型的中医问题
- 覆盖各种检索场景
- 测试异常情况处理
- 验证边界条件

### 2. 数据验证
- 验证测试数据格式
- 检查输入参数有效性
- 确保结果数据完整性
- 防止数据污染

### 3. 可靠性
- 处理网络超时情况
- 应对系统资源不足
- 支持测试中断恢复
- 保证数据一致性

## 扩展性需求

### 1. 配置灵活性
- 支持自定义评分权重
- 可调整检索参数
- 灵活的测试样本选择
- 可配置的输出格式

### 2. 算法扩展
- 支持新的评估指标
- 可插拔的评分算法
- 自定义相似度计算
- 扩展融合效果评估

### 3. 集成能力
- 支持CI/CD集成
- 提供API接口
- 支持自动化测试
- 便于系统监控集成

## 交付物

### 1. 核心程序
- qa_quality_test.py - 完整版测试程序
- simple_qa_test.py - 简化版测试程序
- run_test.bat - Windows启动脚本

### 2. 文档
- 测试程序使用说明.md - 详细使用指南
- requirements.md - 需求文档
- 代码注释和文档字符串

### 3. 配置文件
- 测试参数配置
- 评分权重设置
- 系统集成配置

## 验收标准

### 1. 功能完整性
- ✅ 成功加载测试数据集
- ✅ 正确初始化混合检索系统
- ✅ 实现所有评估指标
- ✅ 生成完整测试报告

### 2. 性能指标
- ✅ 支持100个测试样本的批量处理
- ✅ 平均响应时间 < 1秒
- ✅ 成功率 > 90%
- ✅ 内存使用合理

### 3. 用户体验
- ✅ 提供清晰的进度显示
- ✅ 友好的错误提示
- ✅ 直观的结果展示
- ✅ 完整的使用文档

### 4. 代码质量
- ✅ 遵循Python编码规范
- ✅ 完整的异常处理
- ✅ 清晰的代码注释
- ✅ 模块化设计

---

**需求版本**: v1.0  
**创建时间**: 2025-01-05  
**负责人**: Kiro AI Assistant  
**状态**: 已完成